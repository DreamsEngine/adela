- breadcrumb :catalog_distribution, @distribution
.row
  .col-md-9
    %h3 Documentar un Recurso de Datos
.row
  .col-md-9
    = form_for(@distribution) do |f|
      .form-group.required
        = f.label :title, class: 'control-label'
        = f.text_field :title, required: true, class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.title')}"
      .form-group.required
        = f.label :description, class: 'control-label'
        = f.text_area :description, required: true, class: 'autosize form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.description')}"
      .form-group.required
        = f.label :download_url, 'URL para descargar'
        = f.url_field :download_url, class: 'form-control', required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.download_url')}"
      .row
        = f.hidden_field(:temporal)
        .col-xs-6
          .form-group.required
            = f.label :temporal, 'Inicio del período de tiempo cubierto', class: 'control-label'
            %input#init-date.dcat-temporal.datepicker.form-control{ type: "text", placeholder: "Inicio", required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.temporal.init')}" }
        .col-xs-6
          .form-group.required
            = f.label :temporal, 'Fin del período de tiempo cubierto', class: 'control-label'
            %input#term-date.dcat-temporal.datepicker.form-control{ type: "text", placeholder: "Fin", required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.temporal.term')}" }
      .row
        .col-xs-6
          .form-group.required
            = f.label :modified, 'Fecha de última modificación de datos',  class: 'control-label'
            = f.text_field :modified, value: f.object.modified&.strftime('%F'), class: 'form-control input-icon datepicker', required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.modified')}"
        .col-xs-6
          .form-group.required
            = f.label :byte_size, 'Tamaño en Bytes'
            = f.text_field :byte_size,  class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.byte_size')}"
      .row
        .col-xs-6
          - unless @distribution.issued?
            .form-group.required
              = f.label :publish_date, class: 'control-label'
              = f.text_field :publish_date, value: f.object.publish_date&.strftime('%F'), required: true, class: 'datepicker auto_submit_item form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.publish_date')}"
      = f.button 'Guardar avance', type: 'submit', class: 'btn btn-primary btn-lg pull-right'
      = link_to 'Cancelar', edit_dataset_path(@distribution.dataset), class: 'btn btn-alt btn-lg'
      .clearfix
  .col-md-3
    %p
      Los metadatos ayudan a que los usuarios entiendan las características de la información que se está publicando. La documentación es importante porque afecta la calidad de los datos y el potencial de su uso e impacto.
:javascript
  $(function () {
    $("form").validate({
      errorPlacement: function(error, element) {
        // Find if element has a calendar sibling
        var calendar = $(element).parent().find("i.fa-calendar");
        var hasCalendarField = calendar.length > 0;
        if (hasCalendarField) {
          // Insert error outside .input-group to avoid messing up the style
          error.insertAfter(calendar.parent().parent());
          // Add red border to calendar-icon span element
          calendar.parent().addClass("error");
        } else {
          error.insertAfter(element);
        }
      }
    });

    function onDistributionTemporalChange() {
      var initDate, termDate, dcatTemporal;

      initDate = $('#init-date').val();
      termDate = $('#term-date').val();

      dcatTemporal = initDate + "/" + termDate;
      $('#distribution_temporal').val(dcatTemporal);
    }

    function loadTemporalValues() {
      var initDate, termDate, dcatTemporal;

      dcatTemporal = $('#distribution_temporal').val().split('/');
      initDate = dcatTemporal[0];
      termDate = dcatTemporal[1];

      $('#init-date').val(initDate);
      $('#term-date').val(termDate);
    }

    $.datepicker.setDefaults({ dateFormat: 'yy-mm-dd' });
    loadTemporalValues();
    $('.dcat-temporal').change(onDistributionTemporalChange);
  })
