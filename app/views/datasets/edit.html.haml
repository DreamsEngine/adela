- breadcrumb :catalog_dataset
.row
  .col-md-9
    %h3 Documentar un Conjunto de Datos
.row
  .col-md-9
    = form_for(@dataset, remote: true) do |f|
      .form-group.required
        = f.label :title, class: 'control-label'
        = f.text_field :title, required: true, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.title')}"
      .form-group.required
        = f.label :description, class: 'control-label'
        = f.text_area :description, required: true, class: 'form-control auto_submit_item autosize', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.description')}"
      .row
        .col-xs-6
          .form-group.required
            = f.label :accrual_periodicity, class: 'control-label'
            = f.select :accrual_periodicity, iso8601_repeating_interval_options_for_select(f.object.accrual_periodicity), {}, required: true, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.accrual_periodicity')}"
        .col-xs-6
          .form-group.required
            = f.label :publish_date, class: 'control-label'
            = f.text_field :publish_date, value: f.object.publish_date.strftime('%F'), class: 'datepicker auto_submit_item form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.publish_date')}"
      .form-group
        = f.label :contact_name, class: 'control-label'
        = f.text_field :contact_name, class: 'auto_submit_item form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.contact_name')}"
      .row
        .col-xs-6
          .form-group.required
            = f.label :contact_position, 'Cargo del responsable'
            = f.text_field :contact_position, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.contact_position')}"
        .col-xs-6
          .form-group.required
            = f.label :mbox, 'Correo del responsable'
            = f.email_field :mbox, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.email_field')}"
      .row
        .col-xs-6
          .form-group.required
            = f.label :spatial
            = f.text_field :spatial, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.spatial')}"
        .col-xs-6
          .form-group.required
            = f.label :temporal
            = f.text_field :temporal, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.temporal')}"
      .form-group.required
        = f.label :landing_page, 'URL para consultar diccionario de datos'
        = f.url_field :landing_page, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.landing_page')}"
      .form-group.required
        = f.label :dataset_sectors, 'Sector'
        = f.fields_for :dataset_sector do |sector_form|
          = sector_form.select :sector_id, options_for_sectors_select, { include_blank: true }, { class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.sector')}" }
      .form-group.required
        = f.label :keyword, 'Palabras clave (separadas por coma)'
        = f.text_area :keyword, class: 'form-control auto_submit_item', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.keyword')}"
  .col-md-3
    .jumbotron.center
      %p
        %strong Tour de Ayuda
      %p
        = link_to 'Comenzar', '#no-scroll-please', class: 'btn btn-primary btn-lg btn-block', id: 'get-tour'
    %p
      Los metadatos ayudan a que los usuarios entiendan las características de la información que
      se está publicando. La documentación es importante porque afecta la calidad de los datos y el
      potencial de su uso e impacto.
.row
  .col-md-9
    .bs-callout.bs-callout-default
      %h3 Continúa con la documentación de los recursos de datos
      .table-responsive
        %table.table
          %thead.catalog-header
            %tr
              %th Nombre
              %th.center Estatus de publicación
              %th.center Acciones
          %tbody
            - @dataset.distributions.each do |distribution|
              %tr.distribution
                %td= distribution.title
                %td.center= state_description(distribution)
                %td.center
                  %ul.nav.nav-pills.nav-justified
                    %li{role: 'presentation'}
                      = link_to edit_distribution_path(distribution) do
                        %span.icon.icon-right
                          = inline_svg 'edit.svg'
                        Documentar
.row
  .col-md-9.margin-top-20
    = link_to 'Volver al catálogo', catalog_datasets_path(current_organization.catalog), class: 'btn btn-alt btn-default btn-lg'
    - if (next_dataset = next_dataset(@dataset))
      = link_to edit_dataset_path(next_dataset), { class: 'btn btn-alt btn-default btn-lg pull-right' } do
        Siguiente conjunto
        %span.icon.icon-left
          = inline_svg 'next.svg'
    .clearfix
    %br
    = render 'tour_edit'

:javascript
  $(function() {
    $('.auto_submit_item').change(function() {
      $('form').submit();
      toastr.success("#{t('flash.notice.dataset.update')}");
    });
    $('tr:contains("Listo para publicar")').addClass('success');
    // Init
    $("#tour").joyride({
      autoStart: false
    });
    $('#get-tour').click(function() {
      // Show on click
      $("#tour").joyride({});
    });
  });
